---
import './skeleton.css';

interface BaseSkeletonProps {
	/**
	 * The class of the skeleton. Defaults to `undefined`.
	 */
	class?: string;

	/**
	 * The radius of the skeleton. Defaults to `lg`.
	 * 
	 * This property is ignored for the `circle` variant.
	 */
	radius?: 'none' | 'sm' | 'md' | 'lg';

	/**
	 * The animation of the skeleton. Defaults to `slide`.
	 * 
	 * This property defaults to none when the user has reduced motion enabled.
	 */
	animation?: 'none' | 'slide' | 'pulse';
}

interface TextSkeletonProps extends BaseSkeletonProps {
	/**
	 * The variant of the skeleton. `text` is used for long lines of text.
	 */
	variant: 'text';

	/**
	 * The width of the skeleton. Defaults to `100%`.
	 */
	width?: `${number}%` | `${number}px` | `${number}rem`;

	/**
	 * The height of the skeleton. Defaults to `100%`.
	 */
	height?: `${number}%` | `${number}px` | `${number}rem`;
}

interface CardSkeletonProps extends BaseSkeletonProps {
	/**
	 * The variant of the skeleton. `card` is used for cards which contain other Skeleton components.
	 */
	variant: 'card';

	/**
	 * The width of the skeleton. Defaults to `100%`.
	 */
	width?: `${number}%` | `${number}px` | `${number}rem`;

	/**
	 * The height of the skeleton. Defaults to `100%`.
	 */
	height?: `${number}%` | `${number}px` | `${number}rem`;

	/**
	 * The direction of the skeleton. Defaults to `column`.
	 */
	direction?: 'row' | 'column';

	/**
	 * The horizontal alignment of the skeleton. Defaults to `center`.
	 */
	hAlign?: 'start' | 'center' | 'end';

	/**
	 * The vertical alignment of the skeleton. Defaults to `center`.
	 */
	vAlign?: 'start' | 'center' | 'end';

	/**
	 * The gap between the skeletons. Defaults to `0.5rem`.
	 */
	gap?: `${number}px` | `${number}rem`;
}

interface BlockSkeletonProps extends BaseSkeletonProps {
	/**
	 * The variant of the skeleton. `block` is used for parallelograms.
	 */
	variant: 'block';

	/**
	 * The width of the skeleton.
	 */
	width: `${number}%` | `${number}px` | `${number}rem`;

	/**
	 * The height of the skeleton.
	 */
	height: `${number}%` | `${number}px` | `${number}rem`;
}

interface CircleSkeletonProps extends BaseSkeletonProps {
	/**
	 * The variant of the skeleton. `circle` is used for circular elements.
	 */
	variant: 'circle';

	/**
	 * The width of the skeleton.
	 */
	width: `${number}%` | `${number}px` | `${number}rem`;

	/**
	 * The height of the skeleton.
	 */
	height: `${number}%` | `${number}px` | `${number}rem`;
}

type Props = TextSkeletonProps | CardSkeletonProps | BlockSkeletonProps | CircleSkeletonProps;

const { 
	variant,
	width,
	height,
	radius = 'lg',
	animation = 'slide',
	class: className,
} = Astro.props;

const gap = variant === 'card' ? Astro.props.gap ?? '0.5rem' : undefined;

const styles = [
 width && `width: ${width};`,
 height && `height: ${height};`,
 gap && `gap: ${gap};`
].filter(Boolean).join(' ');

function getClasses() {
	const classes = ['sui-skeleton'];

	if (variant) {
		classes.push(`sui-skeleton-${variant}`);
		
		if (variant === 'card') {
			const direction = Astro.props.direction ?? 'column';
			const hAlign = Astro.props.hAlign ?? 'center';
			const vAlign = Astro.props.vAlign ?? 'center';
			
			classes.push(`sui-skeleton-${direction}`);
			
			const hAlignProp = direction === 'row' ? 'justify' : 'align';
			const vAlignProp = direction === 'row' ? 'items' : 'justify';
			
			classes.push(`sui-skeleton-${hAlignProp}-${hAlign}`);
			classes.push(`sui-skeleton-${vAlignProp}-${vAlign}`);
		}
	}

	if (radius !== 'none' && variant !== 'circle') {
		classes.push(`sui-skeleton-radii-${radius}`);
	}

	if (animation !== 'none' && variant !== 'card') {
		classes.push(`sui-skeleton-anim-${animation}`);
	}
	if (className) {
		classes.push(className);
	}

	return classes;
}
---

<div class:list={getClasses()} style={styles}>
	<slot />
</div>